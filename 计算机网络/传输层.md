# 传输层


## 讲一下TCP的拥塞控制和滑动窗口

TCP的拥塞控制：
拥塞控制的原因以及代价：
* 情况一：两个发送方和一个具有无穷大缓存的路由器  。在一种理想的情况下 当分组的速率接近链路容量时，分组将会经历巨大的排队时延
* 情况二：两个发送方和一个具有有限缓存的路由器，当分组到达一个已满的缓存时会被丢弃，假定每一个连接都是可靠的，即当分组被丢弃时，需要重传。则产生了另外一种网络拥塞的开销，即发送方必须执行重传以补偿因为缓存溢出而丢弃的分组
* 发送方在遇到大时延时所进行的不必要重传会引起路由器利用其链路带宽来转发不必要的分组拷贝
* 当一个分组沿一条路径被丢弃时，每个上游路由器用于转发该分组到丢弃该分组而使用的传输容量最终被浪费掉了
有两种拥塞控制的方式；1.端到端的拥塞控制，用的比较多。2.网络辅助的拥塞控制，即当路由器发生阻塞时，告诉发送方网络的拥塞情况。
1.ATM ABR拥塞控制：ATM基本是采用一种面向虚电路方法来处理分组交换问题，这意味着源到目的地路径上的每一台交换机将维护有关源到目的地VC状态，这种逐个VC状态允许交换机跟踪各个发送方的行为，并采取源特定的拥塞控制动作（例如当交换机变得拥塞时，向发送方法显式信令以减少它的速率）
2. TCP必须使用端到端的拥塞控制，因为IP不会为向端系统提供显式的网络拥塞。所以出现几个问题，我们需要解决这个问题。发送方是如何限制发送速率的？发送方是如何感受到网络拥塞的？当感受到拥塞时采用什么算法进而改变发送速率的？
首先回答第一个问题，每一个tcp的发送方和接收方都会维护一个发送缓存、接收缓存、以及一些变量，其中有一个变量叫做拥塞窗口。其中你最后发送出去的字节序号-已经确认的字节序号需要小于接收窗口于拥塞窗口的最小值（接收窗口时接受缓存的一部分，接受缓存包含接收窗口与缓存中的数据），所以假设接收窗口很大，所以可以粗略的计算出来在一个RTT,只能发送CongWin大小的字节。
回答第二个问题，当发送方出现丢包的时候，如果是超时没有收到接收方的ack，或者是收到冗余的数据报，我们就可以知道当前网络出现拥塞状态。
回答第三个问题：加性增、乘性减、慢启动、对超时事件作出反应
即当发送方感受到了网络拥塞，会将拥塞窗口减少一半，最少一个MSS。当网络良好的状态情况下，会将拥塞窗口每次增加一个MSS.
在开始如果使用每次增加一个MSS的速率，会浪费带宽，所以采取在最开始时，若发送一个报文段，并且收到确认报文，我们就会翻倍的增加拥塞窗口的大小。直到发生丢包。开始将拥塞窗口减少到一半，然后再线性增加。
发生超时丢包和三个冗余的数据包的处理方式是不一样的。当收到三个冗余的数据包时，会将拥塞窗口减半。这是因为数据包的一部分被接收端收到了，则没有必要将拥塞窗口放到最小的情况。而若是超时，则需要保守处理。



## TCP流量控制
TCP流量控制。一条TCP连接双方都会有一个接受缓存，当接收方收到数据时，相关联的进程就会从接收方的缓存中读取。当读的速度慢于发送的速率，导致接收缓存溢出。所以需要流量控制，实际上就是一个速度匹配的问题。
需要两部分来把握这件事。一个接收缓存里面包含接收窗口和存放的数据。在接收缓存里的数据-进程读取的数据<buffer。另外一个 发送的数据最后序号-确认的数据序号< window。我们可以把window发送给发送方。这样就可以保证不会溢出。
最后有一个问题：当接收方的缓存为满时，他会向发送方发一个window=0的报文。但当接收方的有缓存时，这时候没有数据要发给发送方。这时发送方会被阻塞。故TCP规定当窗口为满时，发送方发送一个字节的数据报。这个数据报会被接收方确认，并发送一个新的窗口大小给发送方。
## 传输层和网络层分别是做什么的
首先传输层位于网络层与应用层的中间。运输层为运行在不同主机上的进程之间提供逻辑通信，而网络层则提供了两个主机的之间的逻辑通信。
网络层协议有一个叫IP的, IP为主机之间提供逻辑通信，它的模型原则是尽力而为的交付任务，它不保证报文段的按序交付，也不保证数据的完整性。其中运输层提供两个协议，TCP和UDP，一个提供不可靠的传输，UDP提供不可靠的传输。他们的主要任务是将两个系统间ip交付服务扩展为两个端系统上的进程之间交付服务。
传输层的作用：多路复用与多路分解。多路分解是将运输层的数据交付到正确的套接字，也就是交付到不同的进程。多路复用指的是从源主机中获得的数据封装上头部信息，从而生成报文段，然后将报文段传递到网络层中。
网络层的作用很简单，就是将数据从一台主机上移动到另一台主机上，其中有两个很重要的功能即转发和选路。转发指的是当分组到达路由器的一个输入链路时，该路由需将分组移动到适当的链路上。而选路指的是分组从发送方到接收方之间的路径选择。

